<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Resume Builder 2.0 | Curtis Venn</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <style>
    /* Custom Scrollbar for the form side */
    .form-scroll::-webkit-scrollbar { width: 6px; }
    .form-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
    .form-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    .form-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

    /* Transitions */
    .btn-icon { transition: all 0.2s; }
    .btn-icon:hover { transform: scale(1.1); }

    /* --- PRINT / PDF CSS --- 
       This allows users to use "Save as PDF" in Chrome/Edge/Safari 
       to get a VECTOR PDF (Selectable text) which is ATS friendly. 
    */
    @media print {
      body { margin: 0; padding: 0; background: white; }
      header, footer, aside, .no-print { display: none !important; }
      
      /* Make the preview container the main body */
      main { 
        display: block !important; 
        width: 100% !important; 
        max-width: none !important; 
        margin: 0 !important; 
        padding: 0 !important;
      }
      
      .grid { display: block !important; } /* Break the main grid */
      
      #resumePreview {
        width: 100% !important;
        margin: 0 !important;
        padding: 0 !important;
        box-shadow: none !important;
        border: none !important;
        border-radius: 0 !important;
        /* Force background graphics to show */
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
      }

      /* Page Break Handling */
      h1, h2, h3, h4, .section-head { break-after: avoid; }
      .entry-item { break-inside: avoid; }
    }

    /* Screen Preview Sizing */
    #resumePreview {
      aspect-ratio: 210/297; /* A4 Ratio */
      min-height: 297mm;
      background: white;
      transform-origin: top center;
    }
  </style>
</head>
<body class="bg-slate-100 font-sans text-slate-900 flex flex-col h-screen overflow-hidden">

  <header class="bg-white border-b h-16 flex-none z-50">
    <div class="max-w-[1600px] mx-auto px-4 h-full flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="bg-blue-600 text-white p-1.5 rounded-lg">
          <i class="ph ph-file-pdf text-xl"></i>
        </div>
        <div>
            <h1 class="font-bold text-lg leading-tight">Resume<span class="text-blue-600">Builder</span></h1>
            <p class="text-xs text-slate-500">Auto-saving enabled</p>
        </div>
      </div>

      <div class="flex gap-3">
        <button onclick="triggerImport()" class="hidden md:flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-blue-600 px-3 py-2 rounded transition">
          <i class="ph ph-upload-simple"></i> Import JSON
        </button>
        <button onclick="exportJSON()" class="hidden md:flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-blue-600 px-3 py-2 rounded transition">
          <i class="ph ph-download-simple"></i> Save JSON
        </button>
        <div class="h-6 w-px bg-slate-300 mx-1 hidden md:block"></div>
        <button onclick="printResume()" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded shadow transition text-sm font-medium">
          <i class="ph ph-printer"></i> Download / Print PDF
        </button>
      </div>
    </div>
  </header>

  <main class="flex flex-1 overflow-hidden max-w-[1600px] mx-auto w-full">
    
    <aside class="w-full md:w-[450px] lg:w-[500px] bg-white border-r flex flex-col h-full flex-none z-20 shadow-xl md:shadow-none absolute md:relative transform -translate-x-full md:translate-x-0 transition-transform duration-300" id="editorSidebar">
      
      <div class="p-4 border-b bg-slate-50 flex items-center gap-2 overflow-x-auto">
        <select id="template" class="bg-white border border-slate-300 text-sm rounded px-2 py-1.5 focus:outline-none focus:border-blue-500">
            <option value="modern">Modern</option>
            <option value="classic">Classic</option>
            <option value="minimal">Minimal (ATS)</option>
            <option value="creative">Creative</option>
            <option value="professional">Professional</option>
        </select>
        <div class="flex items-center gap-2 border rounded bg-white px-2 py-1.5">
            <span class="text-xs font-bold text-slate-500">Color:</span>
            <input type="color" id="accentColor" value="#2563eb" class="w-6 h-6 border-none cursor-pointer p-0 bg-transparent">
        </div>
        <button onclick="resetData()" class="ml-auto text-xs text-red-500 hover:underline">Reset</button>
      </div>

      <div class="flex-1 overflow-y-auto form-scroll p-5 space-y-6">
        
        <section>
          <h2 class="text-xs font-bold uppercase tracking-wider text-slate-400 mb-3">Identity</h2>
          <div class="space-y-3">
            <input id="inputName" class="w-full border border-slate-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-100 outline-none" placeholder="Full Name">
            <input id="inputTitle" class="w-full border border-slate-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-100 outline-none" placeholder="Job Title / Role">
            <textarea id="inputSummary" rows="3" class="w-full border border-slate-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-100 outline-none" placeholder="Professional Summary..."></textarea>
          </div>
        </section>

        <section>
            <h2 class="text-xs font-bold uppercase tracking-wider text-slate-400 mb-3">Contact Info</h2>
            <div class="grid grid-cols-2 gap-3">
              <input id="inputEmail" class="border border-slate-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-100 outline-none" placeholder="Email">
              <input id="inputPhone" class="border border-slate-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-100 outline-none" placeholder="Phone">
              <input id="inputLocation" class="border border-slate-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-100 outline-none" placeholder="City, State">
              <input id="inputWebsite" class="border border-slate-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-100 outline-none" placeholder="Portfolio URL">
            </div>
        </section>

        <section>
          <div class="flex justify-between items-center mb-3">
            <h2 class="text-xs font-bold uppercase tracking-wider text-slate-400">Experience</h2>
            <button onclick="addJob()" class="text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded hover:bg-blue-100 font-semibold flex items-center gap-1">
                <i class="ph-bold ph-plus"></i> Add
            </button>
          </div>
          <div id="workContainer" class="space-y-4">
             </div>
        </section>

        <section>
            <div class="flex justify-between items-center mb-3">
              <h2 class="text-xs font-bold uppercase tracking-wider text-slate-400">Education</h2>
              <button onclick="addEdu()" class="text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded hover:bg-blue-100 font-semibold flex items-center gap-1">
                  <i class="ph-bold ph-plus"></i> Add
              </button>
            </div>
            <div id="eduContainer" class="space-y-4">
               </div>
        </section>

        <section>
            <h2 class="text-xs font-bold uppercase tracking-wider text-slate-400 mb-3">Skills</h2>
            <div class="flex gap-2 mb-2">
                <input id="skillInput" class="flex-1 border border-slate-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-100 outline-none" placeholder="Add a skill (Press Enter)">
                <button onclick="addSkill()" class="bg-slate-800 text-white px-3 py-2 rounded text-sm hover:bg-black">Add</button>
            </div>
            <div id="skillList" class="flex flex-wrap gap-2"></div>
        </section>
        
        <div class="h-10"></div> </div>
    </aside>

    <section class="flex-1 bg-slate-200 overflow-y-auto p-4 md:p-8 flex justify-center relative">
      <button onclick="toggleSidebar()" class="md:hidden absolute top-4 left-4 z-30 bg-white p-2 rounded shadow">
        <i class="ph ph-list text-xl"></i>
      </button>

      <div class="w-full max-w-[210mm]">
        <div id="resumePreview" class="shadow-2xl">
            </div>
        <p class="text-center text-slate-400 text-xs mt-4 no-print">
            Use <strong>Ctrl + P</strong> (or Cmd + P) to save as PDF. <br>
            Ensure "Background Graphics" is checked in print settings.
        </p>
      </div>
    </section>

  </main>
  
  <input type="file" id="jsonFile" accept=".json" class="hidden" onchange="importJSON(this)">

<script>
/* -------------------
   Resume Builder 2.0 Logic
   ------------------- */
const $ = sel => document.querySelector(sel);
const escapeHtml = s => String(s || '').replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;');

/* --- State Management --- */
const defaultData = {
    meta: { template: 'modern', color: '#2563eb' },
    profile: {
        name: 'Curtis Venn',
        title: 'Product Creator | Leader',
        email: 'curtis.hi@gmail.com',
        phone: '801-555-0123',
        location: 'Salt Lake City, UT',
        website: 'curtisvenn.com',
        summary: 'Collaborative leader and creator. Helping to simplify work life and see the bigger picture. Documented strengths in building and maintaining relationships with diverse range of stakeholders in dynamic, fast-paced settings.'
    },
    jobs: [
        {
            id: 1, job: 'Operations Specialist', company: 'LendingClub', years: '2025 - Present',
            details: ['Fraud Investigations & Risk Management', 'Optimized onboarding workflow reducing time by 15%', 'Managed high-priority disputes']
        },
        {
            id: 2, job: 'Data Analyst', company: 'Tesla', years: '2024 - 2024',
            details: ['Identified and interpreted trends in complex data sets', 'Trained AI models via precise data annotation', 'Upheld strict confidentiality standards']
        }
    ],
    edus: [
        { id: 1, school: 'Salt Lake Community College', degree: 'Computer Science', years: '2019-2021' }
    ],
    skills: ['Client Relations', 'Data Analysis', 'HTML/CSS', 'CRM Software', 'Fraud Prevention', 'AI Prompting']
};

// Reactive Data Store
let resumeData = JSON.parse(localStorage.getItem('cv_builder_data')) || JSON.parse(JSON.stringify(defaultData));

/* --- Core Functions --- */

function saveData() {
    localStorage.setItem('cv_builder_data', JSON.stringify(resumeData));
    renderPreview();
}

function renderForm() {
    // Meta
    $('#template').value = resumeData.meta.template;
    $('#accentColor').value = resumeData.meta.color;

    // Profile
    $('#inputName').value = resumeData.profile.name;
    $('#inputTitle').value = resumeData.profile.title;
    $('#inputEmail').value = resumeData.profile.email;
    $('#inputPhone').value = resumeData.profile.phone;
    $('#inputLocation').value = resumeData.profile.location;
    $('#inputWebsite').value = resumeData.profile.website;
    $('#inputSummary').value = resumeData.profile.summary;

    // Jobs
    const workContainer = $('#workContainer');
    workContainer.innerHTML = '';
    resumeData.jobs.forEach((job, index) => {
        const div = document.createElement('div');
        div.className = 'bg-slate-50 border rounded-lg p-3 relative group transition-all hover:border-blue-300 hover:shadow-sm';
        div.innerHTML = `
            <div class="flex justify-between items-center mb-2">
                <div class="flex gap-1">
                    <button onclick="moveJob(${index}, -1)" class="p-1 hover:bg-slate-200 rounded text-slate-500 disabled:opacity-30" ${index === 0 ? 'disabled' : ''}><i class="ph ph-arrow-up"></i></button>
                    <button onclick="moveJob(${index}, 1)" class="p-1 hover:bg-slate-200 rounded text-slate-500 disabled:opacity-30" ${index === resumeData.jobs.length - 1 ? 'disabled' : ''}><i class="ph ph-arrow-down"></i></button>
                </div>
                <button onclick="removeJob(${index})" class="text-slate-400 hover:text-red-500 p-1"><i class="ph ph-trash"></i></button>
            </div>
            <div class="grid gap-2 mb-2">
                <input oninput="updateJob(${index}, 'job', this.value)" value="${escapeHtml(job.job)}" placeholder="Job Title" class="bg-white border rounded px-2 py-1 text-sm font-semibold">
                <div class="flex gap-2">
                    <input oninput="updateJob(${index}, 'company', this.value)" value="${escapeHtml(job.company)}" placeholder="Company" class="bg-white border rounded px-2 py-1 text-sm flex-1">
                    <input oninput="updateJob(${index}, 'years', this.value)" value="${escapeHtml(job.years)}" placeholder="Dates" class="bg-white border rounded px-2 py-1 text-sm w-32">
                </div>
            </div>
            <div class="pl-2 border-l-2 border-slate-200 space-y-2">
                ${job.details.map((detail, dIndex) => `
                    <div class="flex gap-1 items-center">
                        <input oninput="updateJobDetail(${index}, ${dIndex}, this.value)" value="${escapeHtml(detail)}" class="flex-1 bg-transparent border-b border-transparent hover:border-slate-300 focus:border-blue-500 text-sm py-0.5 outline-none transition-colors" placeholder="• Responsibility">
                        <button onclick="removeJobDetail(${index}, ${dIndex})" class="text-slate-300 hover:text-red-400"><i class="ph ph-x"></i></button>
                    </div>
                `).join('')}
                <button onclick="addJobDetail(${index})" class="text-xs text-blue-600 hover:underline font-medium">+ Add Bullet</button>
            </div>
        `;
        workContainer.appendChild(div);
    });

    // Edu
    const eduContainer = $('#eduContainer');
    eduContainer.innerHTML = '';
    resumeData.edus.forEach((edu, index) => {
        const div = document.createElement('div');
        div.className = 'bg-slate-50 border rounded-lg p-3 relative hover:border-blue-300';
        div.innerHTML = `
            <div class="flex justify-between items-center mb-2">
                <div class="flex gap-1">
                    <button onclick="moveEdu(${index}, -1)" class="p-1 hover:bg-slate-200 rounded text-slate-500 disabled:opacity-30" ${index === 0 ? 'disabled' : ''}><i class="ph ph-arrow-up"></i></button>
                    <button onclick="moveEdu(${index}, 1)" class="p-1 hover:bg-slate-200 rounded text-slate-500 disabled:opacity-30" ${index === resumeData.edus.length - 1 ? 'disabled' : ''}><i class="ph ph-arrow-down"></i></button>
                </div>
                <button onclick="removeEdu(${index})" class="text-slate-400 hover:text-red-500 p-1"><i class="ph ph-trash"></i></button>
            </div>
            <input oninput="updateEdu(${index}, 'school', this.value)" value="${escapeHtml(edu.school)}" placeholder="School" class="w-full bg-white border rounded px-2 py-1 text-sm mb-1 font-semibold">
            <div class="flex gap-2">
                <input oninput="updateEdu(${index}, 'degree', this.value)" value="${escapeHtml(edu.degree)}" placeholder="Degree" class="flex-1 bg-white border rounded px-2 py-1 text-sm">
                <input oninput="updateEdu(${index}, 'years', this.value)" value="${escapeHtml(edu.years)}" placeholder="Dates" class="w-24 bg-white border rounded px-2 py-1 text-sm">
            </div>
        `;
        eduContainer.appendChild(div);
    });

    // Skills
    const skillList = $('#skillList');
    skillList.innerHTML = '';
    resumeData.skills.forEach((skill, index) => {
        const tag = document.createElement('span');
        tag.className = 'inline-flex items-center gap-1 bg-slate-200 text-slate-700 px-2 py-1 rounded text-xs';
        tag.innerHTML = `${escapeHtml(skill)} <button onclick="removeSkill(${index})" class="hover:text-red-600"><i class="ph-bold ph-x"></i></button>`;
        skillList.appendChild(tag);
    });
}

function renderPreview() {
    const { profile, jobs, edus, skills, meta } = resumeData;
    const accent = meta.color;
    const tmpl = meta.template;
    const s = escapeHtml;

    // Helper for generating RGB background with opacity
    const hexToRgb = (hex) => {
        let r=0,g=0,b=0;
        if(hex.length === 4){ r="0x"+hex[1]+hex[1]; g="0x"+hex[2]+hex[2]; b="0x"+hex[3]+hex[3]; }
        else if(hex.length === 7){ r="0x"+hex[1]+hex[2]; g="0x"+hex[3]+hex[4]; b="0x"+hex[5]+hex[6]; }
        return `${+r},${+g},${+b}`;
    }
    const accentRgb = hexToRgb(accent);

    let html = '';
    const contactHtml = `
        <div class="flex flex-wrap gap-x-4 gap-y-1 text-[10pt] opacity-80 justify-center ${tmpl === 'modern' ? 'text-white' : ''}">
            ${profile.email ? `<span><i class="ph-bold ph-envelope-simple"></i> ${s(profile.email)}</span>` : ''}
            ${profile.phone ? `<span><i class="ph-bold ph-phone"></i> ${s(profile.phone)}</span>` : ''}
            ${profile.location ? `<span><i class="ph-bold ph-map-pin"></i> ${s(profile.location)}</span>` : ''}
            ${profile.website ? `<span><i class="ph-bold ph-globe"></i> ${s(profile.website)}</span>` : ''}
        </div>
    `;

    /* --- TEMPLATES --- */

    if (tmpl === 'modern') {
        html = `
            <div class="h-full flex flex-col">
                <div class="p-8 text-white" style="background: linear-gradient(135deg, ${accent} 0%, ${accent}dd 100%)">
                    <h1 class="text-4xl font-bold uppercase tracking-tight mb-2">${s(profile.name)}</h1>
                    <p class="text-xl opacity-90 mb-4 font-light">${s(profile.title)}</p>
                    <div class="border-t border-white/30 pt-4 flex flex-wrap gap-4 text-sm opacity-90">
                        ${contactHtml.replace(/text-\[10pt\]/g, 'text-sm').replace(/justify-center/g, '')}
                    </div>
                </div>
                <div class="p-8 grid grid-cols-12 gap-8 flex-1 text-slate-800">
                    <div class="col-span-8">
                        <div class="mb-6">
                            <h3 class="text-xs font-bold uppercase tracking-widest mb-3 border-b-2 pb-1" style="color:${accent}; border-color:${accent}">Summary</h3>
                            <p class="text-sm leading-relaxed text-justify">${s(profile.summary)}</p>
                        </div>
                        <div class="mb-6">
                            <h3 class="text-xs font-bold uppercase tracking-widest mb-4 border-b-2 pb-1" style="color:${accent}; border-color:${accent}">Experience</h3>
                            ${jobs.map(j => `
                                <div class="mb-5 entry-item">
                                    <div class="flex justify-between items-baseline mb-1">
                                        <div class="font-bold text-lg text-slate-900">${s(j.job)}</div>
                                        <div class="text-sm font-medium text-slate-500 whitespace-nowrap">${s(j.years)}</div>
                                    </div>
                                    <div class="text-sm font-semibold mb-2" style="color:${accent}">${s(j.company)}</div>
                                    <ul class="list-disc ml-4 text-sm space-y-1 text-slate-600">
                                        ${j.details.map(d => `<li>${s(d)}</li>`).join('')}
                                    </ul>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="col-span-4 space-y-8">
                        <div>
                            <h3 class="text-xs font-bold uppercase tracking-widest mb-3 border-b-2 pb-1" style="color:${accent}; border-color:${accent}">Skills</h3>
                            <div class="flex flex-wrap gap-2">
                                ${skills.map(k => `<span class="text-xs font-semibold px-2 py-1 rounded bg-slate-100 text-slate-700">${s(k)}</span>`).join('')}
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xs font-bold uppercase tracking-widest mb-3 border-b-2 pb-1" style="color:${accent}; border-color:${accent}">Education</h3>
                            ${edus.map(e => `
                                <div class="mb-3">
                                    <div class="font-bold text-sm">${s(e.school)}</div>
                                    <div class="text-xs text-slate-600">${s(e.degree)}</div>
                                    <div class="text-xs text-slate-400 mt-1">${s(e.years)}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            </div>
        `;
    } else if (tmpl === 'minimal') {
        html = `
            <div class="p-10 text-slate-900 h-full">
                <div class="border-b-2 pb-4 mb-6" style="border-color:${accent}">
                    <h1 class="text-3xl font-bold mb-1 uppercase tracking-wider">${s(profile.name)}</h1>
                    <div class="flex justify-between items-end">
                        <div class="text-lg text-slate-600 font-medium">${s(profile.title)}</div>
                        <div class="text-right text-xs text-slate-500">
                            <div>${s(profile.email)} | ${s(profile.phone)}</div>
                            <div>${s(profile.location)} | ${s(profile.website)}</div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-5">
                    <h3 class="text-sm font-bold uppercase mb-2" style="color:${accent}">Professional Summary</h3>
                    <p class="text-sm leading-relaxed">${s(profile.summary)}</p>
                </div>

                <div class="mb-5">
                    <h3 class="text-sm font-bold uppercase mb-3" style="color:${accent}">Experience</h3>
                    ${jobs.map(j => `
                        <div class="mb-4 entry-item">
                            <div class="flex justify-between font-bold text-sm">
                                <span>${s(j.job)} <span class="font-normal text-slate-600">at ${s(j.company)}</span></span>
                                <span>${s(j.years)}</span>
                            </div>
                            <ul class="list-disc ml-5 mt-1 text-sm text-slate-700">
                                ${j.details.map(d => `<li>${s(d)}</li>`).join('')}
                            </ul>
                        </div>
                    `).join('')}
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-sm font-bold uppercase mb-3" style="color:${accent}">Education</h3>
                        ${edus.map(e => `
                            <div class="mb-2">
                                <div class="font-bold text-sm">${s(e.school)}</div>
                                <div class="text-sm text-slate-600">${s(e.degree)}</div>
                                <div class="text-xs italic text-slate-400">${s(e.years)}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div>
                        <h3 class="text-sm font-bold uppercase mb-3" style="color:${accent}">Key Skills</h3>
                        <p class="text-sm leading-6">${skills.map(k => s(k)).join(' • ')}</p>
                    </div>
                </div>
            </div>
        `;
    } else if (tmpl === 'creative') {
        html = `
            <div class="flex h-full">
                <div class="w-1/3 p-8 text-white flex flex-col gap-6" style="background-color: ${accent}">
                    <div class="text-center">
                         <div class="w-24 h-24 bg-white/20 rounded-full mx-auto mb-4 flex items-center justify-center text-3xl font-bold border-2 border-white/50">
                            ${profile.name.charAt(0)}
                         </div>
                         <h1 class="text-2xl font-bold leading-tight mb-2">${s(profile.name)}</h1>
                         <p class="text-sm opacity-90">${s(profile.title)}</p>
                    </div>

                    <div class="mt-4 space-y-2 text-sm opacity-90">
                        <div class="flex items-center gap-2"><i class="ph-bold ph-envelope-simple"></i> ${s(profile.email)}</div>
                        <div class="flex items-center gap-2"><i class="ph-bold ph-phone"></i> ${s(profile.phone)}</div>
                        <div class="flex items-center gap-2"><i class="ph-bold ph-map-pin"></i> ${s(profile.location)}</div>
                        <div class="flex items-center gap-2"><i class="ph-bold ph-globe"></i> ${s(profile.website)}</div>
                    </div>

                    <div class="mt-auto">
                        <h3 class="font-bold uppercase tracking-widest text-xs border-b border-white/30 pb-1 mb-3">Education</h3>
                         ${edus.map(e => `
                            <div class="mb-3 text-sm">
                                <div class="font-bold">${s(e.school)}</div>
                                <div class="text-xs opacity-80">${s(e.degree)}</div>
                                <div class="text-xs opacity-60">${s(e.years)}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div>
                        <h3 class="font-bold uppercase tracking-widest text-xs border-b border-white/30 pb-1 mb-3">Skills</h3>
                        <div class="flex flex-wrap gap-2">
                             ${skills.map(k => `<span class="text-xs bg-white/20 px-2 py-1 rounded">${s(k)}</span>`).join('')}
                        </div>
                    </div>
                </div>

                <div class="w-2/3 p-10 bg-white text-slate-800">
                    <div class="mb-8">
                        <h2 class="text-xl font-bold uppercase tracking-widest mb-4 flex items-center gap-2" style="color:${accent}">
                            <i class="ph-duotone ph-user"></i> Profile
                        </h2>
                        <p class="text-sm leading-relaxed text-slate-600">${s(profile.summary)}</p>
                    </div>

                    <div>
                        <h2 class="text-xl font-bold uppercase tracking-widest mb-6 flex items-center gap-2" style="color:${accent}">
                            <i class="ph-duotone ph-briefcase"></i> Experience
                        </h2>
                        <div class="border-l-2 ml-2 pl-6 space-y-8" style="border-color:${accent}40">
                             ${jobs.map(j => `
                                <div class="relative entry-item">
                                    <div class="absolute -left-[31px] top-1 w-3 h-3 rounded-full border-2 bg-white" style="border-color:${accent}"></div>
                                    <div class="flex justify-between items-baseline mb-1">
                                        <h3 class="font-bold text-lg">${s(j.job)}</h3>
                                        <span class="text-xs font-bold px-2 py-1 rounded bg-slate-100">${s(j.years)}</span>
                                    </div>
                                    <div class="text-sm font-semibold mb-2 opacity-70">${s(j.company)}</div>
                                    <ul class="list-disc ml-4 text-sm text-slate-600 space-y-1">
                                        ${j.details.map(d => `<li>${s(d)}</li>`).join('')}
                                    </ul>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            </div>
        `;
    } else {
        // Fallback / Classic
        html = `
            <div class="p-10 text-slate-800 h-full">
                <div class="text-center border-b pb-6 mb-6">
                    <h1 class="text-4xl font-serif font-bold mb-2">${s(profile.name)}</h1>
                    <p class="text-lg italic text-slate-600 mb-3">${s(profile.title)}</p>
                    <div class="text-sm text-slate-500 space-x-2">
                        <span>${s(profile.email)}</span> &bull; <span>${s(profile.phone)}</span> &bull; <span>${s(profile.location)}</span>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="text-sm font-bold uppercase tracking-widest border-b mb-3 pb-1">Summary</h3>
                    <p class="text-sm text-justify">${s(profile.summary)}</p>
                </div>

                <div class="mb-6">
                    <h3 class="text-sm font-bold uppercase tracking-widest border-b mb-4 pb-1">Experience</h3>
                     ${jobs.map(j => `
                        <div class="mb-5 entry-item">
                            <div class="flex justify-between font-bold">
                                <span>${s(j.company)}</span>
                                <span>${s(j.years)}</span>
                            </div>
                            <div class="italic text-sm mb-2">${s(j.job)}</div>
                            <ul class="list-disc ml-5 text-sm space-y-1">
                                ${j.details.map(d => `<li>${s(d)}</li>`).join('')}
                            </ul>
                        </div>
                    `).join('')}
                </div>

                <div class="mb-6">
                    <h3 class="text-sm font-bold uppercase tracking-widest border-b mb-3 pb-1">Education</h3>
                     ${edus.map(e => `
                        <div class="flex justify-between text-sm mb-2">
                            <div><strong>${s(e.school)}</strong>, ${s(e.degree)}</div>
                            <div>${s(e.years)}</div>
                        </div>
                    `).join('')}
                </div>
                
                <div>
                     <h3 class="text-sm font-bold uppercase tracking-widest border-b mb-3 pb-1">Skills</h3>
                     <p class="text-sm">${skills.join(', ')}</p>
                </div>
            </div>
        `;
    }

    $('#resumePreview').innerHTML = html;
}

/* --- Listeners & Helpers --- */

// Profile Inputs
['inputName','inputTitle','inputEmail','inputPhone','inputLocation','inputWebsite','inputSummary'].forEach(id => {
    $( '#' + id ).addEventListener('input', (e) => {
        const key = id.replace('input','').toLowerCase();
        resumeData.profile[key] = e.target.value;
        saveData();
    });
});

// Meta Inputs
$('#template').addEventListener('change', (e) => { resumeData.meta.template = e.target.value; saveData(); });
$('#accentColor').addEventListener('input', (e) => { resumeData.meta.color = e.target.value; saveData(); });

// Jobs
function addJob() {
    resumeData.jobs.unshift({ job:'New Job', company:'Company', years:'2024', details:['Did cool things'] });
    renderForm(); saveData();
}
function updateJob(i, k, v) { resumeData.jobs[i][k] = v; saveData(); }
function removeJob(i) { resumeData.jobs.splice(i,1); renderForm(); saveData(); }
function updateJobDetail(i, di, v) { resumeData.jobs[i].details[di] = v; saveData(); }
function addJobDetail(i) { resumeData.jobs[i].details.push(''); renderForm(); saveData(); }
function removeJobDetail(i, di) { resumeData.jobs[i].details.splice(di,1); renderForm(); saveData(); }
function moveJob(i, dir) {
    const item = resumeData.jobs.splice(i, 1)[0];
    resumeData.jobs.splice(i + dir, 0, item);
    renderForm(); saveData();
}

// Edu
function addEdu() {
    resumeData.edus.unshift({ school:'University', degree:'Degree', years:'2020' });
    renderForm(); saveData();
}
function updateEdu(i, k, v) { resumeData.edus[i][k] = v; saveData(); }
function removeEdu(i) { resumeData.edus.splice(i,1); renderForm(); saveData(); }
function moveEdu(i, dir) {
    const item = resumeData.edus.splice(i, 1)[0];
    resumeData.edus.splice(i + dir, 0, item);
    renderForm(); saveData();
}

// Skills
function addSkill() {
    const v = $('#skillInput').value.trim();
    if(v) { resumeData.skills.push(v); $('#skillInput').value=''; renderForm(); saveData(); }
}
$('#skillInput').addEventListener('keydown', e => { if(e.key==='Enter') addSkill(); });
function removeSkill(i) { resumeData.skills.splice(i,1); renderForm(); saveData(); }

// Actions
function resetData() {
    if(confirm('Reset all data to default sample?')) {
        resumeData = JSON.parse(JSON.stringify(defaultData));
        saveData();
        renderForm();
    }
}

function printResume() {
    window.print(); 
}

function toggleSidebar() {
    const sb = document.getElementById('editorSidebar');
    sb.classList.toggle('-translate-x-full');
}

/* --- JSON Import/Export --- */
function exportJSON() {
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(resumeData));
    const downloadAnchorNode = document.createElement('a');
    downloadAnchorNode.setAttribute("href", dataStr);
    downloadAnchorNode.setAttribute("download", "resume_" + resumeData.profile.name.replace(/ /g,"_") + ".json");
    document.body.appendChild(downloadAnchorNode);
    downloadAnchorNode.click();
    downloadAnchorNode.remove();
}

function triggerImport() {
    $('#jsonFile').click();
}

function importJSON(input) {
    const file = input.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            resumeData = JSON.parse(e.target.result);
            saveData();
            renderForm();
            alert('Resume loaded successfully!');
        } catch(err) {
            alert('Invalid JSON file.');
        }
    };
    reader.readAsText(file);
}

/* --- Init --- */
renderForm();
renderPreview();

</script>
</body>
</html>
